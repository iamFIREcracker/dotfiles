(cg:define-guesser apt-install
    ;; On Ubuntu, Bash suggests you to `apt install XXX` when the command
    ;; you just run was not found inside PATH.
    ;; This guesser looks looks for that suggestion.
    ("(sudo apt install [^ ]+)" (apt-cmd))
  (format NIL "~a " apt-cmd))

(cg:define-guesser br
    ;; Poor's urlview!
    ;; https://gist.github.com/gruber/249502
    ("((?i)\\b((?:[a-z][\\w-]+:(?:/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’])))"
     (url))
  (format NIL "br '~a' " url))

(cg:define-guesser git-b-git-delete
    ;; How many times have you run `git branch -v` looking for _gone_ branches,
    ;; and then run `git branch -d` to clean up your local repo?
    ("^\\*?\\s+([^ ]+)\\s+([a-f0-9]{7,9})\\s(\\[gone]\\s*.*)" (branch commit rest))
  (format NIL "git branch -d '~a' # ~a -> ~a" branch commit rest))

(cg:define-guesser git-b-git-checkout
    ;; Parses `git branch -v`'s output and suggests you to switch to one of the
    ;; local branches
    ("^\\*?\\s+([^ ]+)\\s+([a-f0-9]{7,10})\\s(.*)" (branch commit rest))
  (format NIL "git checkout '~a' # ~a -> ~a" branch commit rest))

(cg:define-guesser git-branch-delete
    ;; Sometimes, when deleting a branch, `git` refuses to delete it and spits
    ;; out a lot of text suggesting to use `git branch -D ..` instead.
    ("'(git branch -D [^ ]+)'" (git-cmd))
  (format NIL "~a" git-cmd))

(cg:define-guesser git-l-git-show
    ("^([a-f0-9]{7,10}) (.*)" (commit rest))
  (format NIL "git show '~a' # ~a" commit rest))

(cg:define-guesser git-log-git-show
    ("^commit ([a-f0-9]{40})" (commit))
  (format NIL "git show '~a'" commit ))

(cg:define-guesser kill-kill9
    ;; Have you have run `kill $PID` only to discover the process got stuck
    ;; somewhere, and the only way to terminate it was to `kill -9` it?  Well
    ;; this one looks for `kill $PID` lines, and suggests `kill -9 $PID`
    ;; instead.
    ("kill ([0-9]+)" (pid))
  (format NIL "kill -9 '~a'" pid))

(cg:define-guesser ports-kill
    ("^(\\w+)\\s+([0-9]+)\\s+(\\w+)\\s+(\\w+)" (command pid user fd))
  (format NIL "kill '~a' # FD ~a locked by ~a (~a)" pid fd command user))

(cg:define-guesser psg-kill
    ("^([0-9]+)\\s+(.+)" (pid command))
  (format NIL "kill '~a' # ~a " pid command))
