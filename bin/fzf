#!/usr/bin/env bash

EXE=$(realpath ~/.vim/pack/bundle/start/fzf/bin/fzf)
if ! hash cygpath 2>/dev/null; then
  "$EXE" "$@"
else
  stdin=$(tempfile .fzf.in)
  stdout=$(tempfile .fzf.out)
  wrapper=$(tempfile .fzf.sh)
  trap "rm -f $wrapper $stdout $stdin" EXIT

  # save stdin into a temporary file
  cat - > "$stdin"

  # create wrapper
  cat > "$wrapper" <<EOF
(cat "$stdin") | "$EXE" $@ > $stdout
EOF

  # run fzf through cmd.exe -- stolen from: https://github.com/junegunn/fzf.vim
  cmd.exe /C 'set "TERM=" & start /WAIT sh -c '"$wrapper"
  cat "$stdout"
fi
